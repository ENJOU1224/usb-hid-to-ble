/**
 * @file crc32.h
 * @brief CRC32计算头文件
 *
 * ## 架构说明
 *
 * ### 1. 模块定位
 * 本模块属于系统的数据完整性验证层，提供CRC32校验和计算功能。
 * 主要职责：
 * - CRC32校验和计算
 * - 数据完整性验证
 * - 固件完整性检查
 * - 数据传输错误检测
 *
 * ### 2. 依赖关系
 * - 上层调用: ota_manager.c（固件完整性验证）、其他需要数据验证的模块
 * - 下层依赖: crc32.c（CRC32算法实现）
 * - 数据依赖: 无
 *
 * ### 3. 关键数据结构
 * - CRC32算法参数:
 *   - 多项式: 0x04C11DB7（标准CRC32）
 *   - 初始值: 0xFFFFFFFF
 *   - 最终异或值: 0xFFFFFFFF
 *   - 反转输入/输出: 无
 *
 * ### 4. 核心算法
 * - 查表法: 使用预计算的查找表加速CRC32计算
 * - 逐字节处理: 对每个字节进行查表和异或操作
 * - 多项式除法: 基于CRC32多项式的模2除法
 *
 * ## 使用指南
 *
 * ### CRC32计算流程
 * 1. 初始化CRC值为0xFFFFFFFF
 * 2. 对每个数据字节进行查表和异或操作
 * 3. 最后与0xFFFFFFFF进行异或得到最终CRC32值
 *
 * ### 常用函数
 * - CRC32_Calculate(): 计算数据的CRC32校验和
 * - CRC32_Verify(): 验证数据的CRC32校验和
 *
 * ## 调试技巧
 * - 使用已知数据测试CRC32计算
 * - 验证CRC32查找表的正确性
 * - 检查数据长度和边界条件
 *
 * @author DIY User & AI Assistant
 * @version V1.0
 */

#ifndef __CRC32_H__
#define __CRC32_H__

#include <stdint.h>

// ===================================================================
// ? CRC32函数声明
// ===================================================================

/**
 * @brief  计算数据的CRC32校验和
 *
 * @param  data    数据指针 - 指向要计算CRC32的数据
 * @param  length  数据长度 - 数据的字节数
 *
 * @return CRC32校验和 - 32位CRC校验值
 *
 * @details
 * #### 功能详细说明
 * 此函数计算指定数据的CRC32校验和。CRC32是一种循环冗余校验算法，
 * 用于检测数据传输或存储过程中的错误。
 *
 * #### 算法原理
 * 1. **初始化**：将CRC值初始化为0xFFFFFFFF
 * 2. **逐字节处理**：对每个数据字节进行以下操作：
 *    - 将当前CRC值的低8位与数据字节异或
 *    - 使用异或结果作为索引查表
 *    - 将查表结果与CRC值右移8位进行异或
 * 3. **最终处理**：将结果与0xFFFFFFFF异或得到最终CRC32值
 *
 * #### 调用示例
 * 计算8字节数据的CRC32校验和。
 *
 * #### 使用场景
 * - 固件完整性验证
 * - 数据传输错误检测
 * - 文件完整性检查
 * - 数据存储验证
 *
 * #### 错误处理
 * - 数据指针为NULL：可能导致内存访问错误
 * - 长度为0：返回初始CRC值
 *
 * #### 边界情况
 * - 空数据：返回0xFFFFFFFF
 * - 大数据量：算法效率较高，适合大数据处理
 * - 重复计算：相同数据总是得到相同CRC32值
 *
 * #### 注意事项
 * - CRC32算法基于标准多项式0x04C11DB7
 * - 初始值和最终异或值都是0xFFFFFFFF
 * - 查表法提高了计算效率
 * - 此函数不包含数据本身，只计算CRC32值
 */
uint32_t CRC32_Calculate(uint8_t *data, uint32_t length);

/**
 * @brief  验证数据的CRC32校验和
 *
 * @param  data    数据指针 - 指向要验证的数据
 * @param  length  数据长度 - 数据的字节数（不包括CRC32）
 * @param  expected_crc  期望的CRC32值 - 预期的CRC32校验和
 *
 * @return 0=校验通过, 1=校验失败
 *
 * @details
 * #### 功能详细说明
 * 此函数验证数据的CRC32校验和是否匹配。通过计算数据的CRC32值，
 * 并与期望的CRC32值进行比较，判断数据是否完整。
 *
 * #### 算法原理
 * 1. **计算CRC32**：调用CRC32_Calculate()计算数据的CRC32值
 * 2. **比较结果**：将计算结果与期望值进行比较
 * 3. **返回结果**：如果相等返回0（校验通过），否则返回1（校验失败）
 *
 * #### 调用示例
 * 验证固件数据的CRC32校验和。
 *
 * #### 使用场景
 * - 固件完整性验证
 * - 数据传输完整性检查
 * - 文件完整性验证
 * - 数据存储完整性检查
 *
 * #### 错误处理
 * - 数据指针为NULL：可能导致内存访问错误
 * - 长度为0：返回校验失败
 * - 期望值不匹配：返回校验失败
 *
 * #### 边界情况
 * - 空数据：返回校验失败
 * - 长度不匹配：返回校验失败
 * - CRC32值不匹配：返回校验失败
 *
 * #### 注意事项
 * - 数据长度不包括CRC32值本身
 * - 期望的CRC32值应该与计算出的CRC32值比较
 * - 此函数用于验证数据完整性，不修改数据
 * - 校验失败表示数据可能已损坏
 */
uint8_t CRC32_Verify(uint8_t *data, uint32_t length, uint32_t expected_crc);

#endif /* __CRC32_H__ */